<br>
<br>

# Chapter 2. 함수형 사고

소프트웨어 구조를 잡는 데 계층형 설계가 좋은 이유

액션을 타임라인으로 시각화해보자.

타임라인을 사용하면 시간에 관한 문제를 잘 풀 수 있다.

<br>
<br>


## 변경 가능성에 따라 코드 나누기

추후에 프로그램이 확장되면서 코드를 변경할 때 드는 비용을 줄이기 위해 함수형 사고로 코드를 구성하면 좋다.

- 먼저 변경 가능성에 따라 코드를 나눠 보자.  

    예) 피자 사업이 성장하면서 토니가 만든 소프트웨어도 사업에 맞춰 달라져야 했다.  
위쪽으로 갈수록 자주 바뀌는 코드가 있고 아래쪽으로 갈수록 자주 바뀌지 않는 코드가 있다.

![image](https://user-images.githubusercontent.com/101503543/229329912-4ad3b86b-c064-4068-9df7-bf493f22140b.png)


<br>
<br>


- **각 계층은 그 아래에 있는 계층을 기반으로 만들어 진다.**  
그래서 각 계층에 있는 코드는 더 안정적인 기반 위에 작성할 수 있다.
이런 구조로 소프트웨어를 만들면 코드를 쉽게 변경할 수 있다.

<br>

- 가장 위에 있는 코드는 의존성이 거의 없기 때문에 쉽게 바꿀 수 있고,  
**아래에 있는 코드는 위의 코드보다 의존성이 많아 바꾸기 어렵지만 자주 바뀌진 않는다.**

<br>

- 함수형 프로그래머는 이 아키텍처 패턴이 계층을 만들기 때문에 **‘계층형 설계’(stratified design)**라고 부른다.
    - 계층형 설계는 일반적으로 **비즈니스 규칙, 도메인 규칙, 기술 스택 계층**으로 나눕니다.
    - 계층형 설계로 만든 코드는 테스트, 재사용, 유지보수가 쉽다.

<br>    
<br>
<br>

## 일급 추상

다음 타임라인 다이어그램은 로봇 한 대가 피자를 만들기 위한 액션들을 보여준다.

![image](https://user-images.githubusercontent.com/101503543/229329957-7d6c2cad-94ba-428b-b004-8a6e10723b8e.png)

타임라인 다이어그램을 사용하면 액션이 시간 순서에 따라 어떻게 실행되는지 볼 수 있다.

액션은 실행 시점에 의존하기 때문에 실행 순서가 중요하다는 것을 잊지 말자.

<br>
<br>

### 분산 시스템을 타임라인으로 시각화하기

토니는 로봇 한 대로 피자를 만들고 있다.  
토니는 피자 하나를 로봇 세 대가 함께 만들면 더 빠를 것이라고 생각했다.  
피자 만드는 작업을 반죽 만들기, 소스 만들기, 치즈 갈기 작업으로 나누고 로봇 세 대가 동시에 일을 하면 더 빨리 만들 수 있다고 생각했다.  
이처럼 **여러 대의 로봇이 함께 일하는 것은 ‘분산 시스템**’을 의미한다.

<br>

분산 시스템에서 독립된 액션의 실행 순서는 어떻게 될지 모른다.  
따라서 다음과 같이 타임라인 다이어그램을 그려 로봇이 프로그래밍한 대로 동작할지 알아보기로 했다.  
(타임라인 그리는 방법은 파트2에서 배움)

![image](https://user-images.githubusercontent.com/101503543/229330046-f651c896-184a-4325-a6eb-d9dca3ff0869.png)

<br>
<br>


타임라인 다이어그램은 문제를 파악하는 데 도움이 되었지만 실행 순서가 섞이는 것은 어떻게 할 수 없었다.

<br>
<br>
<br>


## 각각의 타임라인은 다른 순서로 실행된다.

- **기본적으로 타임라인은 서로 순서를 맞출 수 있는 기능이 없다.**  
다른 타임라인 작업이 끝날 때까지 기다리라는 표시가 없어서 순서대로 다음 단계를 그냥 진행한다.

- **서로 다른 타임라인에 있는 액션 간 실행 순서는 보장할 수 없다.**  
예) 소스가 먼저 완성되고 반죽이 나중에 완성될 수도 있다.  
이 경우 소스를 만드는 로봇은 반죽이 나오기도 전에 반죽을 펴는 작업을 시작한다.

- 토니는 분산 시스템에 대해 배운 것을 회고해본다.
1. **기본적으로 타임라인은 서로 순서를 맞추지 않는다.**  
타임라인은 서로 실행 순서를 맞춰야만 한다.  

2. . **액션이 실행되는 시간은 중요하지 않다.**  
**각각의 타임라인은 다른 타임라인의 순서와 관계없이 만들어야 한다.**  

3. **드물지만 타이밍이 어긋나는 경우는 실제 일어난다.**  
테스트할 때는 문제가 없었지만 실제 서비스에서 문제가 생길 수도 있다.  
타임라인은 항상 올바른 결과를 보장해야 한다.  

4. **타임라인 다이어그램으로 시스템의 문제를 알 수 있다.**  
다이어그램을 보고 치즈가 제시간에 준비되지 않을 수 있다는 것을 알았다. 시스템을 잘 이해하기 위해 타임라인 다이어그램을 계속 쓰기로 했다.

<br>
<br>
<br>

## 타임라인 커팅 : 로봇이 서로를 기다릴 수 있게 하기

- 17장에 타임라인 커팅에 대해 자세히 살펴보겠다.

- 타임라인 커팅
    - 여러 타임라인이 동시에 진행될 때 서로 순서를 맞추는 방법
    - 타임라인 커팅은 고차 동작(high-order operation)으로 구현한다.
    - 각 타임라인은 독립적으로 동작하고 작업이 완료되면 다른 타임라인 끝나기를 기다리기 때문에 어떤 타임라인이 먼저 끝나도 괜찮다.

![image](https://user-images.githubusercontent.com/101503543/229330124-01819ad1-62fe-4ee6-a6de-a8fd97b5e925.png)


<br>
<br>

## 타임라인에 대해 배운 것

1. 타임라인 커팅으로 서로 다른 작업들을 쉽게 이해할 수 있다.
2. 타임라인 다이어그램을 사용하면 시간에 따라 진행하는 작업을 쉽게 이해할 수 있다.
    
    (동시에 실행하는 분산 시스템을 시각화하기 좋다)
    
3. 타임라인 다이어그램은 유연하다.
    
    타임라인을 보고 쉽게 코드로 옮길 수 있다.