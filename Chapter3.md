# Chapter 3. 액션과 계산, 데이터의 차이를 알기

### 액션 / 계산 / 데이터

- 액션 : 실행 시점과 횟수에 의존한다.
    - 예) 이메일 보내기, 데이터 베이스 읽기
- 계산 : 입력으로 출력을 계산한다
    - 예) 최댓값 찾기, 이메일 주소 올바른지 확인하기
- 데이터 : 이벤트에 대한 사실
    - 사용자가 입력한 이메일 주소, 은행 API로 읽은 달러 수량

<br>
<br>

### 모든 개발 과정에서 액션, 계산, 데이터를 구분하는 기술을 적용할 수 있다.

1. 문제에 대해 생각할 때
2. 코딩할 때
3. 코드를 읽을 때

<br>
<br>

### 장보기 과정

액션과 계산, 데이터를 더 명확하게 하기 위해 액션과 계산, 데이터에 해당하는 단계를 각각 다른 열에 그려봅시다. 

그리고 데이터는 액션과 계산의 입력과 출력으로 사용되기 때문에 선으로 연결해 봅시다.

![image](https://user-images.githubusercontent.com/101503543/229330320-32e7916a-2df6-43d3-acac-daca4ea491b1.png)


- 예를 들어 “냉장고 확인하기” 단계는  
“냉장실 확인하기” 단계 / “냉동실 확인하기” 단계로 나누어 액션으로 만들 수 있습니다.  
→ 각 액션은 각각의 데이터를 만들 수 있고 연결할 수 있습니다.

<br>

- “목록에 있는 것 구입하기” 단계도  
“장바구니에 담기” / “계산하기” 단계로 나눌 수 있다.

<br>

⇒ 계속 나누다 보면 점점 더 복잡해진다고 생각할 수 있다.  
**하지만 액션에 숨어 있는 다른 액션이나 계산 또는 데이터를 발견하기 위해 나눌 수 있는 만큼 나누는 것이 좋다.**

<br>
<br>

### 장보기 과정에서 배운 것

1. **액션과 계산, 데이터는 어디에나 적용할 수 있다.**

2. **액션 안에는 계산과 데이터, 또 다른 액션이 숨어 있을지도 모른다.**      
    함수형 프로그래밍에선 액션을 더 작은 액션과 계산, 데이터로 나누고 나누는 것을 언제 멈춰야 할지 아는 것이 중요하다.
    
3. **계산은 더 작은 계산과 데이터로 나누고 연결할 수 있다.**    
    ‘필요한 것 구입하기’ 데이터에서 계산에 필요한 데이터를 찾았다.    
    계산을 더 작은 상황으로 나누는 것이 더 좋은 경우도 있다.    
    계산을 나누면 첫 번째 계산의 결과 데이터가 두 번째 계산의 입력이 됩니다.
    
4. **데이터는 데이터만 조합할 수 있다.**    
    데이터는 다른 영향을 주지 않는 그냥 데이터이다. 그래서 **데이터 찾는 일을 먼저 해야 한다.**    
    데이터를 찾았다면 동작에 대해 많은 것을 알 수 있다.   

5. **계산은 때로 ‘우리 머릿속에서’ 일어난다.**    
    사실 계산 단계가 있지만 잘 보이지 않는 이유는 우리 사고 과정에 녹아있기 때문이다.    
    예) 장을 보는 상황에서 무엇을 사야 할지는 그냥 머릿속에서 저절로 생각난다.    
    현실에서 장을 보다가 갑자기 무엇을 사야 할지 앉아서 목록을 작성하지는 않는다.     
    이처럼 계산은 머릿속에서 나도 모르게 일어난다.     
    하지만 이 사실을 알면 계산을 더 쉽게 찾을 수 있다.    
    어떤 단계에서 무엇인가 결정해야 할 것이 있는지 또는 무엇인가 계획해서 방법을 찾아야 할 것이 있는지 스스로에게 물어보면 된다.    
    결정과 계획은 계산이 될 가능성이 높기 때문이다.
    
<br>
<br>    
<br>

### 데이터에 대해 자세히 알아보기

- 데이터란?
    - 이벤트에 대한 사실
    - 일어난 일의 결과를 기록한 것

<br>

- **데이터에 어떻게 의미를 담나요?**
    - **데이터 구조로 의미를 담을 수 있다.**
    - 예를 들어 목록의 순서가 중요하다면 순서를 보장하는 데이터 구조를 사용하면 된다.
    - 데이터 구조로 도메인을 표현할 수 있다.

<br>

- 불변성
    - 함수형 프로그래머는 불변 데이터 구조를 만들기 위해 2가지 원칙을 사용
        1. 카피-온-라이트 (copy-on-write) : 변경할 때 복사본을 만든다.
        2. 방어적 복사 (defensive copy) : 보관하려고 하는 데이터의 복사본을 만든다.
        
        ⇒ 6장과 7장

<br>

- 데이터의 장점
    - 데이터는 데이터 자체로 할 수 없는게 없어서, 데이터 그대로로 이해할 수 있다.
    1. 직렬화
        
        직렬화된 액션과 계산은 다른 곳에서 잘 동작할 것이라는 보장이 없다.
        
        하지만 직렬화된 데이터는 전송하기나 디스크에 저장했다가 읽기 쉽다
        
    2. 동일성 비교
        
        계산이나 액션은 서로 비교하기 어렵다.
        
        하지만 데이터는 비교하기 쉽다.
        
    3. 자유로운 해석
        
        데이터는 여러 가지 방법으로 해석할 수 있다.
        
        접속 로그는 문제 해결을 위해 사용할 수 있지만, 모니터링을 위해 사용할 수도 있다.

<br>
<br>        

- 데이터의 단점은 무엇인가?
    - 유연하게 해석할 수 있다는 점은 장점이지만,
        
        해석이 반드시 필요하다는 점은 단점이다.
        
        계산은 해석하지 않아도 실행할 수 있다.
        
        하지만 해석하지 않은 데이터는 쓸모없는 바이트일 뿐입니다.
        
<br>
<br>    

### 쿠폰독의 새로운 마케팅 전략

이메일 보내기 A  
데이터베이스에서 구독자 가져오기 A  
쿠폰에 등급 매기기 D  
데이터베이스에서 쿠폰 읽기 A  
이메일 제목 D  
이메일 주소 D  
추천 수 D  
어떤 이메일이 쿠폰을 받을지 결정하기 C  
구독자 DB 레코드 D  
쿠폰 DB D  
쿠폰 목록 DB 레코드 D  
구독자 목록 DB 레코드 D  
이메일 본문 D

<br>
<br>

### 쿠폰 보내는 과정을 그려보기

1. 데이터베이스에서 구독자를 가져오는 것부터 시작    

    구독자 데이터베이스는 계속 바뀌기 때문에 실행 시점에 의존한다.    
    따라서 액션이고, 가져온 ‘구독자 목록’은 데이터이다.

<br>

2. 데이터베이스에서 쿠폰 목록 가져오기    

    쿠폰 데이터베이스는 계속 바뀌기 때문에 실행 시점에 의존한다.    
    따라서 액션이고, 가져온 ‘쿠폰 목록’은 데이터이다.
    
<br>

3. 보내야 할 이메일 목록 만들기    

    함수형 프로그래머는 처리 과정에 필요한 데이터를 만들기도 합니다.    
    ‘구독자 목록’과 ‘쿠폰 목록’을 이용해 만든 ‘이메일 목록 계획하기(→ 이메일 목록)’은 다음 단계에서 사용할 데이터이다.

<br>


![image](https://user-images.githubusercontent.com/101503543/229330343-b2df5871-cb16-4ae8-9fda-ea5e4fb85b59.png)

<br>


4. 이메일 전송하기
    
    이메일 전송 작업은 간단하다. 이메일 메시지에는 수신자와 보낸 내용이 이미 앞에서 다 만들었기 때문에 목록을 순회하면서 그냥 보내면 된다.
    
    여기서 중요한 것은 이메일 목록을 ‘미리 계획했다는 것’이다.

<br>
<br>
<br>

### 이메일 만드는 부분을 자세히 살펴보기

이메일 목록을 계획하는 계산은 구독자 목록 데이터와 쿠폰 목록 데이터를 받는다. 그리고 계산한 결과는 이메일 목록이다.

함수형 프로그래머가 아니라면 이메일을 보내기 전에 목록 자체를 미리 만드는 것이 이상하다고 생각할 수 있다.

하지만 함수형 프로그래밍에선 자연스러운 방법이다. 이제 이메일 목록을 계획하는 계산을 더 작은 계산으로 나눠 보자.

<br>


![image](https://user-images.githubusercontent.com/101503543/229330624-9319e39d-d178-489b-9cae-1291db47d1e1.png)

![image](https://user-images.githubusercontent.com/101503543/229330565-021617ea-2bc2-4b37-be5f-0c47abf686f2.png)


함수형 프로그래머는 일반적으로 가능하면 액션을 쓰지 않으려고 한다. 그리고 계산으로 바꿀 수 있는 액션이 있다면 그렇게 하는 것이 좋다고 한다.

굳이 계산을 사용하려는 이유는 테스트하기 쉽기 때문이다.
계산은 외부에 영향을 주지 않기 때문에 쉽게 테스트 가능하고, 여러 번 테스트도 가능하다.

이메일을 실제로 보내고 결과를 주는 시스템은 테스트하기 어렵다.
하지만 결과가 이메일 목록 데이터인 시스템은 테스트하기 쉽다.
(다음장에서 자세히 설명)


<br>
<br>
<br>


## 쿠폰 보내는 과정 구현하기

- 계산은 입력값으로 출력값을 만드는 것이다.   
호출 시점이나 횟수에 의존하지 않고 동일한 입력값으로 부르면 항상 같은 결과값을 돌려준다.


- 일반적인 구현 순서  
    1. 데이터
    2. 계산
    3. 액션  

- **데이터를 파악하는 것으로 시작해서 계산과 추가 데이터를 도출했다.  
그리고 액션으로 모든 것을 묶었다.**   

- 데이터는 사용하는 데 제약이 많고 액션은 가장 제약이 없다.   
    이와 같이 데이터를 먼저 구현하고 계산을 구현한 후에 마지막으로 액션을 구현하는 것이 함수형 프로그래밍의 일반적인 구현 순서이다.

<br>
<br>

### 쉬는 시간

<br>

**Q. 이메일을 보내기 전 왜 모든 이메일을 만드나요? 비효율적이지 않나요? 사용자가 수백만 명이면 어떻게 하나요?**

사용자가 많다면 메모리 부족으로 시스템이 동작하지 않을 수도 있습니다. 하지만 동작하지 않는다고 단정할 수도 없습니다. 실행하기 전에는 아무도 모르기 때문에 미리 최적화를 하는 것은 좋지 않습니다.

하지만 사용자가 증가한다면 문제가 생길 수도 있기 때문에 확장성에 대해 미리 고려하는 것이 좋을 것 같습니다.

다행히도 이 문제를 해결하기 위해 원래 코드를 거의 그대로 쓸 수 있습니다.

emailsForSubscribers() 함수는 구독자를 배열로 받습니다. 이 함수에 모든 구독자 목록을 한꺼번에 배열로 넘기지 않아도 됩니다. 

구독자 20명을 넘기면 이메일을 20개 얻을 수 있습니다. 20개씩 묶어서 반복하면 모든 구독자의 이메일을 얻을 수 있다.

고쳐야 하는 부분은 fetchSubscribersFromDB() 함수다. 이 함수는 모든 구독자를 리턴하는데, 일부 구독자만 리턴하도록 바꿔야 한다.

<br>


![image](https://user-images.githubusercontent.com/101503543/229331172-2d730b83-3f6c-4879-ae0f-46b6834d5b65.png)

<br>
<br>

**계산은 고치지 않았다는 것이 중요하다.** 잘 만들어진 시스템이라면 '0보다 크거나 같은 구독자들에 대한 이메일을 가져온다'는 추상적인 개념이 바뀌지 않는 한 계산은 바뀌지 않아야 한다. 데이터 베이스에서 메모리로 읽어오는 것은 액션이다.

**더 작은 개수를 읽도록 액션만 고쳐서 최적화하였다.**

<br>
<br>

## 계산에 대해 자세히 알아보기

- 계산은 무엇인가요?
계산은 입력값으로 출력값을 만드는 것이다. 실행 시점과 횟수에 관계없이 항상 같은 입력값에 대해 같은 출력값을 돌려준다.

<br>

- 계산은 어떻게 구현하는가?
계산은 함수로 구현한다. 

<br>

- 어떻게 계산에 의미를 담는가?
계산에는 연산을 담을 수 있다. 계산은 입렵값을 출력값으로 만드는 것을 표현한다. 계산을 언제 사용할지 또는 어떻게 사용할지는 때에 따라 다르다.

<br>

- 왜 액션보다 계산이 좋은가?
    1. 테스트하기 쉽다.
    2. 기계적인 분석이 쉽다.
    3. 조합하기 좋다.
        계산을 조합해서 더 큰 계산을 만들 수 있다. (이때 일급 계산 high-order를 사용하는데 14장에서 배움)

<br>

- 계산의 예
    1. 더하기나 곱하기
    2. 문자열 합치기
    3. 쇼핑 계획하기

<br>

- 계산을 쓰면서 걱정하지 않아도 되는 것
    1. 동시에 실행되는 것
    2. 과거에 실행되었던 것이나 미래에 실행할 것
    3. 실행 횟수

<br>

- 계산의 단점  
    - 계산과 액션은 실행하기 전에 어떤 일이 발생할지 알 수 없다는 단점이 있다.  
    - 물론 코드를 읽으면 예상할 수 있긴 하지만, 소프트웨어 측면에서 함수는 블랙박스다. 입력값으로 실행해야 결과를 알 수 있다.
    - 이런 단점이 싫다면 계산이나 액션 대신 데이터를 사용해야 한다.

<br>
<br>

## 이미 있는 코드에 함수형 사고 적용하기

<br>

![image](https://user-images.githubusercontent.com/101503543/229331387-5ab37b05-d56e-4d33-826b-345f557dc0bc.png)


액션을 부르는 함수가 있다면 그 함수도 액션이 되고, 그 함수를 부르는 또 다른 함수 역시 액션이 된다.
이런 식으로 작은 액션 하나가 코드 전체로 퍼져 나간다.

그렇기 때문에 함수형 프로그래머는 액션을 가능한 사용하지 않으려고 한다. 액션을 쓰는 순간 코드 전체로 퍼져나가기 때문에 사용할 때 조심해야 한다.

<br>
<br>

## 액션은 다양한 형태로 나타난다.

함수형 프로그래머는 액션을 관리하는 법을 배웁니다.

액션을 관리하기 위해서 액션이 코드에서 어떤 형태로 나타나는지 알아야 합니다.


![image](https://user-images.githubusercontent.com/101503543/229331563-84c7aa24-8f00-49ca-a799-dfaacd81d878.png)

<br>
<br>

## 액션에 대해 자세히 알아보기

- 액션은 무엇인가?
    - 액션은 외부 세계에 영향을 주거나 받는 것을 말한다. 그리고 액션은 실행 시점과 횟수에 의존한다.   

    - 언제 실행되는지 -> 순서  
    얼마나 실행되는지 -> 반복

- 액션은 어떻게 구현하나요?
    - 자바스크립트에서는 함수로 구현한다.
    - 계산도 함수로 구현하기 때문에 구분이 쉽지 않다.
    - 앞으로 계산과 액션을 구분하는 방법을 알아볼 것

- 어떻게 액션에 의미를 담을 수 있나?
    - 액션은 외부 세상에 영향을 줄 수 있다.
    - 따라서 어떤 일을 하라는지 아는 것이 중요하다.

- 액션의 예
    - 이메일 보내기
    - 계좌에서 인출하기
    - 전역변숫값 보내기
    - ajax 요청 보내기

- 액션을 잘 사용하기 위한 방법
    1. 가능한 액션을 적게 사용한다.  
    액션 대신 계산을 사용할 수 있는지 생각해보자. (15장 참고)

    2. 액션은 가능한 작게 만든다.  
    액션에서 액션과 관련 없는 코드는 모두 제거한다.  
    예를 들어, 액션에서 결정이나 계획과 관련된 부분은 계산으로 빼낼 수 있다.

    3. 액션이 외부 세계와 상호작용하는 것을 재현할 수 있다.  
    액션은 외부 세계에 영향을 주거나 받을 수 있다.  
    **내부에 계산과 데이터만 있고 가장 바깥쪽에 액션이 있는 구조가 이상적이다.**  
    이 내용은 18장의 어니언 아키텍처를 다룰 때 살펴보겠다.

    4. 액션이 호출 시점에 의존하는 것을 재현한다.  
    함수형 프로그래머는 액션이 호출 시점과 횟수에 덜 의존하도록 만드는 기술을 알고 있다. 그래서 액션을 사용할 때 좀 더 쉽게 사용 가능하다.

 
<br> 
<br>
<br>


## 결론 및 정리

- 결론
    - 계산은 계획이나 결정을 할 때 적용했고, 데이터는 계획하거나 결정한 결과였다.
    - 액션을 통해 계산으로 만든 계획을 실행할 수 있었다.

<br>

- 요점 정리
    - 함수형 프로그래머는 액션, 계산, 데이터를 구분한다.
    - 액션은 실행 시점이나 횟수에 의존한다. 일반적으로 액션은 외부 세계에 영향을 주거나 받는다.
    - 계산은 입력값으로 출력값을 만드는 것. 외부 세계에 영향을 주거나 받지 않고 실행 시점이나 횟수에 의존하지 않는다.
    - 데이터는 이벤트에 대한 사실이다. 사실은 변하지 않기 때문에 영구적으로 기록할 수 있다.
    - 함수형 프로그래머는 액션보다 계산을 좋아하고, 계산보다 데이터를 좋아한다.
    - 계산은 같은 입력값을 주면 항상 같은 출력값이 나오기 때문에 액션보다 테스트하기 쉽다.



